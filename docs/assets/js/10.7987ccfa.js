(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{373:function(t,s,n){"use strict";n.r(s);var a=n(44),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"part03-controller控制层接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#part03-controller控制层接口"}},[t._v("#")]),t._v(" Part03-Controller控制层接口")]),t._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("blog\n├─src\n│  └─main\n│      ├─java\n│      │  └─org\n│      │      └─myslayers\n│      │          ├─config\n│      │          │      ContextStartup.java\n│      │          │\n│      │          ├─controller\n│      │          │      BaseController.java\n│      │          │      IndexController.java\n│      │          │      PostController.java\n│      │          │\n│      │          ├─service\n│      │          │  │  postService.java\n│      │          │  │\n│      │          │  └─impl\n│      │          │         postServiceImpl.java\n│      │\n│      └─resources\n│          ├─templates\n│          │  │  index.ftl\n│          │  │\n│          │  ├─inc\n│          │  │     header-panel.ftl\n│          │  │\n│          │  └─post\n│          │        category.ftl\n│          │        detail.ftl\n")])])]),n("h2",{attrs:{id:"_3-1-首页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-首页"}},[t._v("#")]),t._v(" 3.1 首页")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("IndexController.java")]),t._v(" ：控制层")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Controller")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IndexController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BaseController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 首页index\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/index"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/index.html"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * 多条（post实体类、PostVo实体类）：分页集合results\n         */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//多条：selectPosts(分页信息、分类id、用户id、置顶、精选、排序)")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IPage")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PostVo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" results "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" postService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selectPosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"created"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postVoDatas"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" results"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * 分类（传入id） -> 渲染分类\n         */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//req：根据传入category表中当前页的id -> 【渲染】分类")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"currentCategoryId"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("index.ftl")]),t._v(" ：模板引擎")])]),t._v(" "),n("div",{staticClass:"language-injectedfreemarker extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<#--宏layout.ftl（导航栏 + 页脚）--\x3e\n<#include "/inc/layout.ftl"/>\n\n<#--【三、填充（导航栏 + 页脚）】--\x3e\n<@layout "首页">\n\n  <#--【二、分类】--\x3e\n  <#include "/inc/header-panel.ftl"/>\n\n  <#--【三、左侧md8 + 右侧md8】--\x3e\n  <div class="layui-container">\n    <div class="layui-row layui-col-space15">\n\n      <#--1.左侧md8--\x3e\n      <div class="layui-col-md8">\n\n        <#--1.1 fly-panel--\x3e\n        <div class="fly-panel">\n          <#--1.1.1 fly-panel-title--\x3e\n          <div class="fly-panel-title fly-filter">\n            <a>置顶</a>\n          </div>\n          <#--1.1.2 消息列表--\x3e\n          <ul class="fly-list">\n              <@details size=2 level=1>\n              <#--1.1.2.1 消息列表--\x3e\n                  <#list results.records as post>\n                      <@plisting post></@plisting>\n                  </#list>\n              </@details>\n          </ul>\n        </div>\n\n        <#--1.2 fly-panel--\x3e\n        <div class="fly-panel" style="margin-bottom: 0;">\n          <#--1.2.1 fly-panel-title--\x3e\n          <div class="fly-panel-title fly-filter">\n            <a href="" class="layui-this">综合</a>\n            <span class="fly-mid"></span>\n            <a href="">未结</a>\n            <span class="fly-mid"></span>\n            <a href="">已结</a>\n            <span class="fly-mid"></span>\n            <a href="">精华</a>\n            <span class="fly-filter-right layui-hide-xs">\n              <a href="" class="layui-this">按最新</a>\n              <span class="fly-mid"></span>\n              <a href="">按热议</a>\n            </span>\n          </div>\n\n          <#--1.2.2 消息列表--\x3e\n          <div class="fly-list">\n              <#list postVoDatas.records as post>\n                  <@plisting post></@plisting>\n              </#list>\n          </div>\n\n          <#--1.2.3 分页条--\x3e\n          <@paging postVoDatas></@paging>\n        </div>\n      </div>\n\n        <#--2.右侧md4--\x3e\n        <#include "/inc/right.ftl"/>\n    </div>\n  </div>\n</@layout>\n')])])]),n("h2",{attrs:{id:"_3-2-导航栏、文章分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-导航栏、文章分类"}},[t._v("#")]),t._v(" 3.2 导航栏、文章分类")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ContextStartup.java")]),t._v(" ：配置类，【向 "),n("code",[t._v("header-panel.ftl")]),t._v(" 传入 "),n("code",[t._v("categorys")]),t._v("】")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextStartup")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationRunner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletContextAware")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CategoryService")]),t._v(" categoryService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletContext")]),t._v(" servletContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 项目启动时，会同时调用该run方法：提前加载导航栏中的“提问、分享、讨论、建议”，并将其list放入servletContext上下文对象\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationArguments")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Category")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" categories "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" categoryService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryWrapper")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Category")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("eq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        servletContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"categorys"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" categories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * servletContext上下文对象\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setServletContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletContext")]),t._v(" servletContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("servletContext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" servletContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("PostController.java")]),t._v(" ：控制类，【向 "),n("code",[t._v("header-panel.ftl")]),t._v(" 传入 "),n("code",[t._v("currentCategoryId")]),t._v("】")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Controller")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PostController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BaseController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 分类category\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/category/{id:\\\\d*}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("category")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * 分类（传入id）-> 渲染分类\n         */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//req：根据传入category表中当前页的id -> 【渲染】分类")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"currentCategoryId"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//req：解决使用<@details categoryId=currentCategoryId pn=pn size=2>时，无法传入参数pn的方法：让pn直接从req请求中获取 -> 作为传入posts方法的参数")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletRequestUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIntParameter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"post/category"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("header-panel.ftl")]),t._v(" ：模板引擎")])]),t._v(" "),n("div",{staticClass:"language-injectedfreemarker extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<#--【二、分类】--\x3e\n<div class="fly-panel fly-column">\n  <div class="layui-container">\n    <ul class="layui-clear">\n      \x3c!-- 首页 --\x3e\n      <li class="${(0 == currentCategoryId)?string(\'layui-hide-xs layui-this\', \'\')}"><a href="/">首页</a></li>\n        <#--提问、分享、讨论、建议--\x3e\n        <#list categorys as item>\n          <li class="${(item.id == currentCategoryId)?string(\'layui-hide-xs layui-this\', \'\')}">\n            <a href="/category/${item.id}">${item.name}</a>\n          </li>\n        </#list>\n      <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li>\n      \x3c!-- 用户登入后显示 --\x3e\n      <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="/user/index#index">我发表的贴</a></li>\n      <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="/user/index#collection">我收藏的贴</a></li>\n    </ul>\n\n    <div class="fly-column-right layui-hide-xs">\n      <span class="fly-search"><i class="layui-icon"></i></span>\n      <a href="post/edit" class="layui-btn">发表新帖</a>\n    </div>\n    <div class="layui-hide-sm layui-show-xs-block" style="margin-top: -10px; padding-bottom: 10px; text-align: center;">\n      <a href="post/edit" class="layui-btn">发表新帖</a>\n    </div>\n  </div>\n</div>\n')])])]),n("ul",[n("li",[n("code",[t._v("category.ftl")]),t._v(" ：模板引擎")])]),t._v(" "),n("div",{staticClass:"language-injectedfreemarker extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<#--宏layout.ftl（导航栏 + 页脚）--\x3e\n<#include "/inc/layout.ftl"/>\n\n<#--【三、填充（导航栏 + 页脚）】--\x3e\n<@layout "博客分类">\n\n  <#--【二、分类】--\x3e\n  <#include "/inc/header-panel.ftl"/>\n\n  <#--【三、左侧md8 + 右侧md8】--\x3e\n  <div class="layui-container">\n    <div class="layui-row layui-col-space15">\n\n      <#--1.左侧md8--\x3e\n      <div class="layui-col-md8">\n        <#--1.2 fly-panel--\x3e\n        <div class="fly-panel" style="margin-bottom: 0;">\n          <#--1.2.1 fly-panel-title--\x3e\n          <div class="fly-panel-title fly-filter">\n            <a href="" class="layui-this">综合</a>\n            <span class="fly-mid"></span>\n            <a href="">未结</a>\n            <span class="fly-mid"></span>\n            <a href="">已结</a>\n            <span class="fly-mid"></span>\n            <a href="">精华</a>\n            <span class="fly-filter-right layui-hide-xs">\n              <a href="" class="layui-this">按最新</a>\n              <span class="fly-mid"></span>\n              <a href="">按热议</a>\n            </span>\n          </div>\n            <#--1.2.2 消息列表--\x3e\n            <@details categoryId=currentCategoryId pn=pn size=2>\n              <ul class="fly-list">\n                <#list results.records as post>\n                  <@plisting post></@plisting>\n                </#list>\n              </ul>\n                <#--1.2.3 分页条--\x3e\n                <@paging results></@paging>\n            </@details>\n        </div>\n      </div>\n\n      <#--2.右侧md4--\x3e\n      <#include "/inc/right.ftl"/>\n    </div>\n  </div>\n\n  <script>\n    layui.cache.page = \'jie\';\n  <\/script>\n</@layout>\n')])])]),n("h2",{attrs:{id:"_3-3-文章详情"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-文章详情"}},[t._v("#")]),t._v(" 3.3 文章详情")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("PostController.java")]),t._v(" ：控制层，【查看】文章、【查看】评论")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Controller")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PostController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BaseController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 详情detail：【查看】文章、【查看】评论\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/post/{id:\\\\d*}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * 一条（post实体类、PostVo实体类）\n         */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//一条：selectOnePost（表 文章id = 传 文章id），因为Mapper中select信息中，id过多引起歧义，故采用p.id")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PostVo")]),t._v(" postVo "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" postService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selectOnePost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryWrapper")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("eq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p.id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//req：PostVo实体类 -> CategoryId属性")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"currentCategoryId"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" postVo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCategoryId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//req：PostVo实体类（回调）")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"post"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" postVo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * 评论（comment实体类）\n         */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//评论：page(分页信息、文章id、用户id、排序)")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IPage")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommentVo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" results "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" commentService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selectComments")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" postVo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"created"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//req：CommentVo分页集合")]),t._v("\n        req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pageData"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" results"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * 文章阅读【缓存实现访问量】：减少访问数据库的次数，存在一个BUG，只与点击链接的次数相关，没有与用户的id进行绑定\n         */")]),t._v("\n        postService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("putViewCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("postVo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"post/detail"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("detail.ftl")]),t._v(" ：模板引擎")])]),t._v(" "),n("div",{staticClass:"language-injectedfreemarker extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<#--宏layout.ftl（导航栏 + 页脚）--\x3e\n<#include "/inc/layout.ftl" />\n\n<#--【三、填充（导航栏 + 页脚）】--\x3e\n<@layout "博客详情">\n\n  <#--【二、分类】--\x3e\n  <#include "/inc/header-panel.ftl" />\n\n  <#--【三、左侧md8 + 右侧md8】--\x3e\n  <div class="layui-container">\n    <div class="layui-row layui-col-space15">\n\n      <#--1.左侧md8--\x3e\n      <div class="layui-col-md8 content detail">\n        <#--1.1文章--\x3e\n        <div class="fly-panel detail-box">\n          <#--1.1.1 文章标题--\x3e\n          <h1>${post.title}</h1>\n\n          <#--1.1.2 文章标签--\x3e\n          <div class="fly-detail-info">\n            <span class="layui-badge layui-bg-green fly-detail-column">${post.categoryName}</span>\n\n            <#if post.level gt 0><span class="layui-badge layui-bg-black">置顶</span></#if>\n            <#if post.recommend><span class="layui-badge layui-bg-red">精帖</span></#if>\n\n            <div class="fly-admin-box" data-id="${post.id}">\n                <#--发布者删除--\x3e\n                <#if post.userId == profile.id  &&  profile.id != 1>\n                  <span class="layui-btn layui-btn-xs jie-admin" type="del">删除</span>\n                </#if>\n\n                <#--管理员操作--\x3e\n                <@shiro.hasRole name="admin">\n                  <span class="layui-btn layui-btn-xs jie-admin" type="set" field="delete" rank="1" reload="true" >删除</span>\n                    <#if post.level == 0><span class="layui-btn layui-btn-xs jie-admin" type="set" field="stick" rank="1">置顶</span></#if>\n                    <#if post.level gt 0><span class="layui-btn layui-btn-xs jie-admin" type="set" field="stick" rank="0" style="background-color:#ccc;">取消置顶</span></#if>\n                    <#if !post.recommend><span class="layui-btn layui-btn-xs jie-admin" type="set" field="status" rank="1">加精</span></#if>\n                    <#if post.recommend><span class="layui-btn layui-btn-xs jie-admin" type="set" field="status" rank="0" style="background-color:#ccc;">取消加精</span></#if>\n                </@shiro.hasRole>\n            </div>\n\n            <span class="fly-list-nums">\n              <a href="#comment"><i class="iconfont" title="回答">&#xe60c;</i>${post.commentCount}</a>\n              <i class="iconfont" title="人气">&#xe60b;</i>${post.viewCount}\n            </span>\n          </div>\n\n          <#--1.1.3 文章作者信息--\x3e\n          <div class="detail-about">\n            <a class="fly-avatar" href="/user/${post.authorId}">\n              <img src="${post.authorAvatar}" alt="${post.authorName}">\n            </a>\n            <div class="fly-detail-user">\n              <a href="/user/${post.authorId}" class="fly-link">\n                <cite>${post.authorName}</cite>\n              </a>\n              <span>${timeAgo(post.created)}</span>\n            </div>\n\n            <div class="detail-hits" id="LAY_jieAdmin" data-id="${post.id}">\n              <#--登录状态下，用户id = 作者id，才能进行【编辑文章】--\x3e\n              <#if profile.id == post.userId>\n                <span class="layui-btn layui-btn-xs jie-admin" type="edit">\n                  <a href="/post/edit?id=${post.id}">编辑此贴</a>\n                </span>\n              </#if>\n              <#--未登录状态下，【缺少span块引起的显示问题】，作用：空占位，美化样式--\x3e\n              <span class="jie-admin" type=""></span>\n            </div>\n          </div>\n\n          <#--1.1.4 文章内容--\x3e\n          <div class="detail-body photos">\n              ${post.content}\n          </div>\n        </div>\n\n        <#--1.2 评论--\x3e\n        <div class="fly-panel detail-box" id="flyReply">\n          <#--1.2.1 回帖线--\x3e\n          <fieldset class="layui-elem-field layui-field-title" style="text-align: center;">\n            <legend>回帖</legend>\n          </fieldset>\n\n          <#--1.2.2 评论区--\x3e\n          <ul class="jieda" id="jieda">\n            <#list pageData.records as comment>\n              <li data-id="${comment.id}" class="jieda-daan">\n                <a name="item-${comment.id}"></a>\n                <div class="detail-about detail-about-reply">\n                  <a class="fly-avatar" href="/user/${post.authorId}">\n                    <img src="${comment.authorAvatar}" alt="${comment.authorName}">\n                  </a>\n                  <div class="fly-detail-user">\n                    <a href="/user/${comment.authorId}" class="fly-link">\n                      <cite>${comment.authorName}</cite>\n                    </a>\n                    <#if comment.user_id == post.user_id>\n                      <span>(楼主)</span>\n                    </#if>\n                  </div>\n                  <div class="detail-hits">\n                    <span>${timeAgo(comment.created)}</span>\n                  </div>\n                </div>\n                <div class="detail-body jieda-body photos">\n                  ${comment.content}\n                </div>\n                <div class="jieda-reply">\n                    <span class="jieda-zan zanok" type="zan">\n                      <i class="iconfont icon-zan"></i>\n                      <em>${comment.voteUp}</em>\n                    </span>\n                  <span type="reply">\n                      <i class="iconfont icon-svgmoban53"></i>\n                      回复\n                    </span>\n                  <div class="jieda-admin">\n                    <span type="del">删除</span>\n                  </div>\n                </div>\n              </li>\n            </#list>\n          </ul>\n\n          <#--1.2.3 评论分页--\x3e\n          <@paging pageData></@paging>\n\n          <#--1.2.4 回复区--\x3e\n          <div class="layui-form layui-form-pane">\n            <form action="/post/reply/" method="post">\n              <div class="layui-form-item layui-form-text">\n                <a name="comment"></a>\n                <div class="layui-input-block">\n                  <textarea id="L_content" name="content" required lay-verify="required"\n                            placeholder="请输入内容" class="layui-textarea fly-editor"\n                            style="height: 150px;"></textarea>\n                </div>\n              </div>\n              <div class="layui-form-item">\n                <input type="hidden" name="jid" value="${post.id}">\n                <button class="layui-btn" lay-filter="*" lay-submit>提交回复</button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n\n      <#--2.右侧md4--\x3e\n      <#include "/inc/right.ftl"/>\n    </div>\n  </div>\n  <script>\n    layui.cache.page = \'jie\';\n  <\/script>\n\n</@layout>\n')])])])])}),[],!1,null,null,null);s.default=e.exports}}]);